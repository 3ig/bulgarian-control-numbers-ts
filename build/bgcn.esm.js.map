{"version":3,"file":"bgcn.esm.js","sources":["../src/pn.ts","../src/egn.ts","../src/bulstat.ts","../src/iban.ts","../src/index.ts"],"sourcesContent":["/**\n * ЛНЧ - Личен номер на чужденец се издава на всички чужденци, които\n * възнамеряват да пребивават продължително време в България. Издава се от МВР.\n */\n\nconst CONTROLS: readonly number[] = [21, 19, 17, 13, 11, 9, 7, 3, 1];\n\nclass PersonalNumber {\n  private _value: string;\n\n  constructor(value: string) {\n    if (typeof value !== \"string\") {\n      throw new Error(`${value} is not of type string!`);\n    }\n\n    this._value = value;\n  }\n\n  get value(): string {\n    return this._value;\n  }\n\n  get isValid(): boolean {\n    if (this._value.length !== 10) {\n      return false;\n    }\n\n    let sum = 0;\n\n    for (let i = 0; i < this._value.length - 1; i++) {\n      sum += ~~this._value.charAt(i) * CONTROLS[i];\n    }\n\n    const mod = sum % 10;\n    return mod === ~~this._value.charAt(9);\n  }\n}\n\nexport default PersonalNumber;\n","/**\n * Всеки български гражданин има ЕГН и това го идентифицира еднозначно. ЕГН се\n * поддържа от ЕСГРАОН.\n */\n\nimport type { Birthday, Gender } from './types';\n\nconst CONTROLS: readonly number[] = [2, 4, 8, 5, 10, 9, 7, 3, 6];\n\nclass EGN {\n  private _value: string;\n  private _gender: Gender;\n  private _birthday: Birthday;\n\n  constructor(value: string) {\n    if (typeof value !== \"string\") {\n      throw new Error(`${value} is not of type string!`);\n    }\n\n    if (value.length !== 10) {\n      throw new Error(`${value} is not of size 10!`);\n    }\n\n    this._value = value;\n    this._gender = \"m\"; // Will be set by _parse()\n    this._birthday = { year: 0, month: 0, day: 0 };\n    this._parse();\n  }\n\n  get value(): string {\n    return this._value;\n  }\n\n  get gender(): Gender {\n    return this._gender;\n  }\n\n  get birthday(): Birthday {\n    return this._birthday;\n  }\n\n  private _parse = (): void => {\n    this._gender = ~~this._value.charAt(8) % 2 === 0 ? \"m\" : \"f\";\n\n    const day = ~~this._value.substr(4, 2);\n    let month = ~~this._value.substr(2, 2);\n    let year = ~~this._value.substr(0, 2);\n\n    if (month > 40) {\n      year += 2000;\n      month -= 40;\n    } else if (month > 20) {\n      year += 1800;\n      month -= 20;\n    } else {\n      year += 1900;\n    }\n\n    this._birthday = { year, month, day };\n  };\n\n  get isValid(): boolean {\n    let sum = 0;\n\n    for (let i = 0; i < this._value.length - 1; i++) {\n      sum += ~~this._value.charAt(i) * CONTROLS[i];\n    }\n\n    let mod = sum % 11;\n    mod = mod < 10 ? mod : 0;\n\n    return mod === ~~this._value.charAt(9);\n  }\n}\n\nexport default EGN;\n","/**\n * Булстат е идентификатор, какъвто има всяка фирма в България. Булстатът може\n * да бъде 9, 10 или 13 знака.\n */\n\nconst CONTROLS_9_1: readonly number[] = [1, 2, 3, 4, 5, 6, 7, 8];\nconst CONTROLS_9_2: readonly number[] = [3, 4, 5, 6, 7, 8, 9, 10];\nconst CONTROLS_13_1: readonly number[] = [2, 7, 3, 5];\nconst CONTROLS_13_2: readonly number[] = [4, 9, 5, 7];\n\nclass Bulstat {\n  private _value: string;\n\n  constructor(value: string) {\n    if (typeof value !== \"string\") {\n      throw new Error(`${value} is not of type string!`);\n    }\n\n    if (value.length > 2 && value.substr(0, 2) == \"BG\") {\n      value = value.substring(2);\n    }\n\n    if (value.length !== 9 && value.length !== 13) {\n      throw new Error(`${value} is not of size 9 or 13!`);\n    }\n\n    this._value = value;\n  }\n\n  get value(): string {\n    return this._value;\n  }\n\n  get isValid(): boolean {\n    const val: number[] = [];\n\n    for (let i = 0; i < this._value.length; i++) {\n      val[i] = ~~this._value.charAt(i);\n    }\n\n    let sum = 0;\n    for (let i = 0; i < 8; i++) {\n      sum += val[i] * CONTROLS_9_1[i];\n    }\n\n    let mod = sum % 11;\n    if (mod > 9) {\n      sum = 0;\n      for (let i = 0; i < 8; i++) {\n        sum += val[i] * CONTROLS_9_2[i];\n      }\n\n      mod = sum % 11;\n      mod = mod > 9 ? 0 : mod;\n    }\n\n    if (this._value.length === 9) {\n      return mod === val[8];\n    }\n\n    // set control for 9-digit BULSTAT\n    val[8] = mod;\n\n    sum = 0;\n    for (let i = 8; i < 12; i++) {\n      sum += val[i] * CONTROLS_13_1[i - 8];\n    }\n\n    mod = sum % 11;\n    if (mod > 9) {\n      sum = 0;\n      for (let i = 8; i < 12; i++) {\n        sum += val[i] * CONTROLS_13_2[i - 8];\n      }\n\n      mod = sum % 11;\n      mod = mod > 9 ? 0 : mod;\n    }\n\n    return mod === val[12];\n  }\n}\n\nexport default Bulstat;\n","/**\n * IBAN е стандарт за международен номер на банкова сметка. Концепцията за\n * международен номер на банкова сметка (International Bank Account Number) е\n * разработена от Европейския комитет за банкови стандарти (EBS 204/август 2003)\n * съвместно с Международната организация по стандартизация (ISO) и е\n * международно признат стандарт ISO 13616:2003. В България е приет от\n * Българския комитет по стандартизация, като стандарт БДС ISO 13616:2004\n * Международен номер на банкова сметка (IBAN) на Българския институт по\n * стандартизация.\n *\n * BGkk bbbb ssss ttcc cccc cc\n *\n * b = BIC bank code\n * s = Branch (BAE) number\n * t = Account type\n * c = Account number\n */\n\nconst MAX_LEN = 22;\n\nclass IBAN {\n  private _value: string;\n  private _bic: string;\n  private _accountNo: string;\n\n  constructor(value: string) {\n    if (typeof value !== \"string\") {\n      throw new Error(`${value} is not of type string!`);\n    }\n\n    value = value.replace(/\\s/g, \"\");\n    if (value.length !== MAX_LEN) {\n      throw new Error(`${value} is not of size ${MAX_LEN}!`);\n    }\n\n    this._value = value;\n    this._bic = `${value.substr(4, 4)}BGSF`;\n    this._accountNo = value.substring(14);\n  }\n\n  get value(): string {\n    return this._value;\n  }\n\n  get bic(): string {\n    return this._bic;\n  }\n\n  get accountNo(): string {\n    return this._accountNo;\n  }\n\n  // credits go to - https://stackoverflow.com/a/16019504\n  private _modulo = (divident: string, divisor: number): number => {\n    const partLength = 10;\n\n    while (divident.length > partLength) {\n      const part = divident.substring(0, partLength);\n      divident = (Number(part) % divisor) + divident.substring(partLength);\n    }\n\n    return Number(divident) % divisor;\n  };\n\n  get isValid(): boolean {\n    // Rearrange\n    let transformed = this._value.substring(4) + this._value.substr(0, 4);\n\n    // Convert to integer\n    const digits: (string | number)[] = [];\n\n    for (let i = 0; i < transformed.length; i++) {\n      const ch = transformed.charAt(i);\n      if (ch >= \"a\" && ch <= \"z\") {\n        digits[i] = ch.charCodeAt(0) - 97 + 10;\n      } else if (ch >= \"A\" && ch <= \"Z\") {\n        digits[i] = ch.charCodeAt(0) - 65 + 10;\n      } else {\n        digits[i] = ch;\n      }\n    }\n\n    // Compute remainder\n    return 1 === this._modulo(digits.join(\"\"), 97);\n  }\n}\n\nexport default IBAN;\n","import PersonalNumber from \"./pn\";\nimport EGN from \"./egn\";\nimport Bulstat from \"./bulstat\";\nimport IBAN from \"./iban\";\n\nclass BGCN {\n  static personalNumber = (value: string): PersonalNumber => {\n    return new PersonalNumber(value);\n  };\n\n  static pn = (value: string): PersonalNumber => {\n    return this.personalNumber(value);\n  };\n\n  static egn = (value: string): EGN => {\n    return new EGN(value);\n  };\n\n  static bulstat = (value: string): EGN | Bulstat => {\n    if (typeof value === \"string\" && value.length === 10) {\n      // 10 знака е Булстат, който е еднакъв с ЕГН на търговеца\n      return new EGN(value);\n    }\n    return new Bulstat(value);\n  };\n\n  static iban = (value: string): IBAN => {\n    return new IBAN(value);\n  };\n\n  static isValid = (value: string): boolean => {\n    if (typeof value !== \"string\") {\n      throw new Error(`${value} is not of type string!`);\n    }\n    value = value.replace(/\\s/g, \"\");\n    switch (value.length) {\n      case 22:\n        return this.iban(value).isValid;\n      case 9:\n      case 11: // BGxxxxxxxxx\n      case 13:\n        return this.bulstat(value).isValid;\n      case 10:\n        return this.egn(value).isValid || this.pn(value).isValid;\n      // default:\n      //   throw new Error(`${value} with size ${value.length} is not a known control number!`);\n    }\n    return false;\n  };\n}\n\nexport default BGCN;\n"],"names":["CONTROLS","PersonalNumber","constructor","value","Error","this","_value","isValid","length","sum","i","charAt","EGN","_parse","_gender","day","substr","month","year","_birthday","gender","birthday","mod","CONTROLS_9_1","CONTROLS_9_2","CONTROLS_13_1","CONTROLS_13_2","Bulstat","substring","val","IBAN","_modulo","divident","divisor","part","Number","replace","_bic","_accountNo","bic","accountNo","transformed","digits","ch","charCodeAt","join","_BGCN","personalNumber","pn","egn","bulstat","iban","BGCN"],"mappings":"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"}